(function(e){function n(e,n){for(var t in n)e[t]=e[t]||n[t];return e}function t(e){var n=Object.keys(e).map(function(n){return[n,encodeURIComponent(e[n])].join("=")});return"?"+n.join("&")}var r={json:function(e){return e.json()},text:function(e){return e.text()},response:true};function o(e,n){var t=Object.prototype.toString.call(n).slice(8,-1);return n!==undefined&&n!==null&&t===e}function s(e){return e}var i={none:s,false:s,null:s,json:JSON.stringify};function f(e,s,f,c,p){f=n({},f);f.method=e;f.headers=n({},f.headers||{});if(f.responseAs!==true&&typeof f.responseAs!=="function"){f.responseAs=r[f.responseAs]||r.json}n(f.headers,{Accept:"application/json","Content-Type":"application/json"});if(p){s+=t(p)}if(c){if(typeof f.encodeAs!=="function"){f.encodeAs=i[f.encodeAs]||i.json}f.body=f.encodeAs(c)}if(o("FormData",c)){delete f.headers["Content-Type"]}if(f.beforeFetch){f.beforeFetch(s,f)}return u.fetch(s,f).then(function(e){if(f.afterFetch){f.afterFetch(s,f)}if(e.status>=200&&e.status<300){if(f.responseAs===true)return e;if(e.status==204)return null;return f.responseAs(e)}if(typeof f.errorAs!=="function"){var n=new Error(e.statusText);n.response=e;throw n}else{throw f.errorAs(e)}})}function u(e,t){if(!/https?:\/\//.test(e))throw new TypeError("Expected url to be a string starting with http:// or https://");t=t||{};var r=function(r,o){if(!r)r=e;else r=e.replace(/\/$/,"")+("/"+r).replace(/^\/\//,"/");o=o||{};n(o,t);return u(r,o)};r.url=e;r.toString=function(){return e};r.inspect=function(){return"<<fetchival "+e+">>"};r.get=function(n){return f("GET",e,t,null,n)};r.post=function(n,r){return f("POST",e,t,n,r)};r.put=function(n,r){return f("PUT",e,t,n,r)};r.patch=function(n,r){return f("PATCH",e,t,n,r)};r.delete=function(n){return f("DELETE",e,t,null,n)};return r}u.fetch=typeof fetch!=="undefined"?fetch.bind(e):null;u.responseHandlers=r;u.encodeHandlers=i;if(typeof exports==="object")module.exports=u;else if(typeof define==="function"&&define.amd)define(function(){return u});else e.fetchival=u})(typeof window!="undefined"?window:undefined);
